---
title: "Trabajo de Investigación - Mineria de Datos"
author: "Elaborado por: Diego Gomez, Ana Rodrigo"
date: "Junio, 2024"
output:
  pdf_document :
    toc: true
    number_sections: true  
  html_document:
    toc: true
    number_sections: true  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r message=FALSE, warning=FALSE, include=FALSE}
library(knitr)
library(dplyr)
library(tidyverse)
library(mice)
library(corrplot)

load("_data/BDO_A.RData")
load("_data/BD.RData")


```


```{r, echo=FALSE, out.width='100%', fig.align='center'}
include_graphics("_fig/logo_umsa2.png")

```


\newpage


# Introducción

El crédito es una operación financiera que permite a una persona acceder a una cantidad de dinero, hasta un límite especificado, durante un período de tiempo determinado. El crédito es una forma de financiación flexible que permite acceder al dinero prestado según las necesidades.

El seguro es el instrumento a través del cual las empresas o personas transfieren riesgos a un tercero, empresa aseguradora, y en caso de siniestro tienen la obligación de indemnizar total o parcialmente sus pérdidas, dependiendo del contexto.

Las entidades aseguradoras otorgan cobertura a riesgos que podrían afectar a bienes, patrimonio o a individuos. Como contraprestación de ello requieren del pago de un monto (prima) y en el caso que suceda un determinado evento que ocasione una pérdida (siniestro) la aseguradora pagará el monto acordado (indemnización), cuyo riesgo de ocurrencia es objeto de cobertura por el seguro. La actividad del mercado inicia con la necesidad que se crea de los clientes a partir de la percepción de un riesgo y para el cual contrata la póliza de seguro de una compañía.

En entidades financieras al momento de otorgar un crédito se realiza la afiliación a diferentes seguros lo cual hace que exista un vinculo cercano entre el financiamiento y acceder a un seguro.

Durante el año 2021, el mercado asegurador boliviano experimentó un desempeño interesante. Aunque las primas directas se mantuvieron casi al mismo nivel que en 2020, hubo un aumento significativo en los pagos por siniestros, superando en más del 55% los montos del año anterior. Esto tuvo un fuerte impacto en el índice de siniestralidad anual, que alcanzó un récord histórico del 80%. Sin embargo, en 2022, se observó una notable disminución, llegando al 53%. Asimismo, para el 2023 existió mejora en los indicadores financieros del mercado asegurador con la reducción de la tasa de siniestralidad e incremento de la producción.

Sin duda, la pandemia ha puesto de manifiesto la importancia crucial de los seguros en nuestra sociedad. Su función fundamental es preservar la integridad de las personas y proteger su patrimonio, especialmente en áreas afectadas por la crisis, como la salud, la vida y el desempleo. La necesidad de reducir la exposición al riesgo se ha vuelto más evidente que nunca, y esto podría beneficiar a largo plazo el modelo de negocio de las compañías de seguros y contribuir a su desarrollo.

Al respecto, se observa un mercado potencial, por lo que los créditos son una fuente de gestión de venta de seguros tanto de personas como patrimoniales.

# Objetivos

## Objetivo General

- Identificar los patrones de comportamientos mediante el análisis de k-medias de los clientes con créditos de seguros del Banco PK.

## Objetivos Específicos
- Relizar la preparación de los datos para así contar con una base sin datos perdidos ni atípicos.
- Relizar el análisis de componentes a las variables numéricas.
- Determinar el número óptimo de clusters para la base de datos.
- Crear un dashboard que presente de manera clara y visual los clusters identificados.

# Motivación
El Banco PK, al contar con una cantidad importante de clientes con canales de alto impacto, pretende conocer el comportamiento de los clientes para poder incrementar los ingresos por la comercialización de seguros. 

Se advierte que el volumen de la cartera del Banco PK, créditos PYME, microcréditos, vivienda y consumo dirigido a personas naturales con cobertura del seguro, tuvo crecimiento en las gestiones 2017-2020 y una reducción al cierre de 2021 como resultado de la contracción económica debido a la pandemia, ya que en esta etapa se otorgó el diferimiento y reprogramación de créditos, pero para la gestión 2022 y 2023 se observa una recuperación de la cartera en riesgo con un crecimiento menor en valor absoluto de la gestión 2020.

La cartera susceptible del seguro está conformada por créditos PYMES, Microcréditos, Hipotecarios, Productivos y de Consumo, los cuales de manera individual han tenido un crecimiento continuo, situación favorable para el desarrollo de nuevos productos de seguros adicionales tomando en cuenta el potencial de la cartera.

Las personas naturales que tienen créditos representan un grupo susceptible para la venta de seguros. Cuando alguien adquiere un préstamo, su interés en proteger su inversión y su capacidad de pago aumenta. Por lo tanto, existe una oportunidad para ofrecerles productos de seguros que cubran riesgos como enfermedades, accidentes o pérdida de empleo.

Además debemos considerar que la cartera de seguros ya está constituida, lo que significa que hay una base de clientes potenciales. A medida que aumenta la colocación de créditos, también se incrementa la demanda de seguros. Esto se debe a que las personas buscan proteger sus activos y garantizar la continuidad de sus compromisos financieros en caso de imprevistos.

En el entorno actual, la gestión efectiva de metas e indicadores es fundamental para el éxito en la industria financiera y aseguradora. Identificar la clasificación de clientes para su gestión comercial es predominante con el objetivo de alcanzar las metas financieras, por lo que desarrollar un dashboard específico para la entidad financiera permitirá visualizar y analizar de manera eficiente los tipos de clientes relacionados con la comercialización de seguros. Esto facilitará la toma de decisiones informadas y la identificación de áreas de mejora.

Se ha observado que los clientes de seguros son variables cada mes por lo que se pretende mantener una tasa de crecimiento constante de acuerdo con las características de los tipos de clientes y a qué tipo de créditos aplican para evaluar en siguientes periodos los tipos de seguros a comercializar por canal, tipo de crédito y cliente. En ese sentido, se pretende generar un dashboard para otorgar la información oportunamente al área ejecutiva para la toma de decisiones entre el banco y aseguradora con acceso para los principales ejecutivos del área comercial.

# Marco Teórico
La clasificación de clientes, a través del seguimiento de ventas y la concentración de ingresos son elementos cruciales para el éxito de cualquier organización comercial. Este marco teórico explora los fundamentos esenciales de estos conceptos y cómo su comprensión y aplicación pueden contribuir a una gestión empresarial efectiva.

TECNICAS DE SEGMENTACIÓN Y CLUSTERING
La segmentación de clientes consiste en un conjunto de acciones por medio de las cuales se seleccionan aspectos en común de la base de clientes y se los divide en diferentes grupos: cada uno de ellos es un segmento de clientes.

Sin embargo, clusterizar, y muchas veces se confunde o no se ve la diferencia con segmentación, es descubrir grupos de clientes similares, a través de variaciones similares dentro de cada grupo. Todo a través de modelos matemáticos.
Básicamente la diferencia es que en la segmentación sólo agrupas en función de criterios de negocio, los cuales, una vez dejan de ser relevantes para definir ese grupo, pueden hacer menos efectiva esa segmentación. Con un cluster, al utilizar criterios matemáticos, está constantemente actualizando los grupos, haciéndolos mucho más efectivos de cara a las posteriores acciones que desarrolles con ellos. Hoy día, este método es utilizado sobre todo en la informática, el marketing, el mundo empresarial y el artístico, y es tremendamente efectivo.

Utilizar una segmentación a través de clusters, en una estrategia de fidelización e incentivación en cualquier marca, puede aportarte las siguientes ventajas:
- Identificar patrones de comportamiento como, por ejemplo, qué compra, cuánto compra, cómo compra, qué factores influye en X situación, en qué momento consume o utiliza nuestro servicio, etc.
- Conocer el perfil de cliente por patrones de consumo homogéneo: por niveles de gasto, CLV (Customer Time Value), localización, hábitos de compra, variables socio demográfico, edad, etc.
- Crear y desarrollar campañas y promociones Ad-hoc y políticas comerciales acorde al comportamiento que reflejan los datos, mejorando la eficiencia de las mismas.
- Priorizar clientes: focalizar acciones concretas de fidelización en clientes de mayor valor.
- Captaciones de nuevos clientes (idénticos): desarrollar acciones de captación orientadas al target con las mismas características que el cluster.
- Redirigir los flujos de clientes hacia clusters de mayor valor. Es una manera incluso de desarrollar técnicas de Up-selling.
- Aumentar la retención: la predicción de clusters susceptibles al abandono permite desarrollar acciones enfocadas a reducir la tasa de abandono.

Seguimiento de Ventas

El seguimiento de ventas implica el monitoreo sistemático de todas las actividades relacionadas con el proceso de ventas de seguros. Desde la generación de leads hasta el cierre de negocios, cada etapa se analiza para evaluar el rendimiento y mejorar la eficacia de las estrategias de ventas.
-	Optimización del Proceso: El seguimiento de ventas permite identificar cuellos de botella y optimizar cada etapa del proceso de ventas para mejorar la eficiencia y aumentar la productividad en la venta de seguros.
-	Toma de Decisiones Basada en Datos: La recopilación y análisis de datos de ventas proporciona información valiosa para la toma de decisiones informada, lo que permite ajustar estrategias según sea necesario.
-	Mejora Continua: Al comprender el rendimiento histórico, las organizaciones pueden implementar mejoras continuas en sus estrategias y tácticas de ventas.

Concentración de Ingresos

La concentración de ingresos se refiere al grado en que los ingresos del Banco dependen de un pequeño número de clientes, productos o segmentos de mercado. Una alta concentración puede ser riesgosa, ya que la pérdida de un cliente clave podría tener un impacto significativo en los ingresos totales.

-	Diversificación de Clientes: Entender y gestionar la concentración de ingresos motiva a las empresas a diversificar su base de clientes, reduciendo la dependencia de fuentes únicas.
-	Gestión de Riesgos: La concentración de ingresos puede aumentar la vulnerabilidad ante cambios en el mercado. La gestión proactiva de riesgos es esencial para mitigar posibles impactos adversos.
-	Planificación Estratégica: Comprender la concentración de ingresos influye en la planificación estratégica. Las organizaciones pueden desarrollar estrategias para reducir riesgos y aprovechar oportunidades de crecimiento.

Importancia de la Gestión de Metas e Indicadores

La gestión de metas e indicadores proporciona una visión integral del rendimiento empresarial. Al establecer y monitorear metas específicas, la entidad financiera puede evaluar su éxito en la comercialización de seguros y ajustar estrategias según sea necesario.

-	Toma de Decisiones Informada: El acceso a indicadores clave a través de un dashboard facilita la toma de decisiones informada. Los líderes de la entidad pueden identificar áreas de mejora, detectar tendencias y anticipar desviaciones en tiempo real, permitiendo una respuesta ágil a las condiciones del mercado.
-	Indicadores de Rendimiento: El dashboard incluirá indicadores como la tasa de crecimiento de cartera, el cumplimiento de metas de ventas y otros relevantes para la comercialización de seguros.
-	Desgloses Geográficos y Temporales: La capacidad de desglosar el rendimiento por región, sucursal o periodo temporal proporcionará insights valiosos para entender variaciones y patrones en la comercialización.
-	Seguridad de Datos y Acceso: Se implementarán medidas de seguridad robustas para garantizar que solo los usuarios autorizados accedan a la información sensible.

# Descripción de la base datos

La base de datos actual proviene de las transacciones de un mes del Banco PK respecto a ingresos no financieros (seguros). En la base de datos se cuenta con *42 variables* y 211k registros de evaluación respecto a datos del cliente, del seguro y operación crediticia. Se detalla a continuación las variables más relevantes para la construcción de los indicadores:

- PRODUCTO: Indica el tipo de seguro adquirido del clientes, el mismo puede ser categorizado como Seguros Personales o seguros generales (patrimoniales).
- DESC_SUCURSAL: Indica el departamento de la sucursal donde se hizo la transacción
- VALOR_ASEGURADO: Muestra el monto monetario del valor del seguro. 
- MONEDA: EL tipo de moneda en el que se hizo la transacción esta puede ser bolivianos, dolares, u otro tipo de moneda.
- TASA_PRIMA_INTERES: La tasa prima de interes, es el porcentaje respecto del valor asegurado que el cliente debe pagar como parte del pago del seguro.
- FECHA_NACIMIENTO: La fecha en la que nacio el cliente, la variable nos ayudara a obtener la edad en años de los clientes
- MONTO_DESEMBOLSADO: Es el valor monetario donde el cliente pidio un prestamo y esta pendiente de devolución a la entidad finaciera.
- OPERACION_CREDITICIA: Es la razón o tipo operación crediticia donde el banco dio un prestamo a un cliente. 
- ACT_EXO_OCUPACION: El tipo de actividad económica del cliente. 

# Metodología




## Tratamiento sobre la base datos 
Para el presente conjunto de datos se cuido que las diferentes variables correpondan a un tipo de dato diferente según su naturaleza, como ser variables categóricas, numericas y otras.
Por otro lado, respecto a los datos faltantes, se observo que son una cantidad muy pequeña respecto del total, asi se decidio omitirlas. Posteriormente, el tratamiento de las diferentes variables se vio directamente para la construcción de cada indicador, y previamente creando algunas variables como la región en base al departamento de origen de la transacción o la edad de los clientes en base a su fecha de nacimiento. 

# Resultados y Análisis

## Preparación

La base de datos de clientes de créditos y seguros cuenta con 211.494 observaciones y 42 variables por lo que se realizó la preparación con la transformación de variables inicialmente para la creación de nuevas variables como ser los días de cobertura del seguro (aplicando diferencia entre las fechas de inicio y fin de cobertura), asimismo, la edad se calculó a partir de la fecha de nacimiento y se realizó la conversión a variable numérica para proceder a aplicar la categorización por rangos de edades con la creación de una nueva


##Selección de variables

Posterior se realizó la selección de 18 variables que son relevantes para la información de los clientes, siendo que se tiene información de transacciones o garantías que no son relevantes para el objeto del estudio. Sin embargo, se crea una nueva base de datos solo con 18 variables de las 45 que se tenía, con la transformación al tipo de variable que corresponde cada atributo de la base de datos, ya sea char, num o factor.


## Datos incompletos

 Se hizo la evaluación de la base de datos para identificar datos incompletos y realizar su tratamiento, por lo que se muestra la matriz de patrones de datos faltantes y la frecuencia de cada patrón.
 
 variable.

```{r}
md.pattern(BD, plot = T)
```
 
La primera columna de la tabla indica el número de filas que tienen un patrón específico de datos faltantes: 

- 211357 filas no tienen datos faltantes en ninguna variable (1 indica que el dato está presente).
- 134 filas tienen un patrón idéntico de presencia y ausencia de datos.
- 2 filas tienen otro patrón de presencia y ausencia de datos.
- 1 fila tiene otro patrón distinto de presencia y ausencia de datos.

Las filas de la matriz indican si los datos están presentes (1) o faltan (0) para cada variable. La última fila indica cuántos valores faltantes hay para cada variable:
- 135 valores faltan en la variable edad.
- 135 valores faltan en la variable rango de edad.
- 276 valores faltan en la variable días de cobertura.

```{r}
kable(flux(BD))
```

La proporción de valores presentes en cada variable, valores cercanos a 1 indican que casi todos los datos están presentes.
+ influx: Proporción de valores faltantes para cada variable en relación con el total de valores faltantes.
+ Variables como PRIMA, CREDITO, diascred, edad, gedad, y diascob tienen valores muy bajos de influx, indicando que los valores faltantes en estas variables constituyen una pequeña fracción del total.
+ outflux: Proporción de datos presentes en una variable que coinciden con datos faltantes en otras variables. La mayoría de las variables tienen un outflux de 1, lo que indica que los datos presentes en estas variables coinciden con los datos presentes en otras variables.
La mayoría de las variables tienen muy pocos o ningún valor faltante.
Algunas variables, como edad y gedad, tienen un número ligeramente mayor de valores faltantes.
El influx y outflux indican que los valores faltantes están dispersos entre las observaciones y no se concentran en una sola variable.
El análisis sugiere que la base de datos es bastante completa, con algunas variables que tienen un pequeño número de valores faltantes. Los patrones de datos faltantes parecen ser dispersos, sin concentrarse en una sola variable, por lo que se aplicará el método listwise con variables que sean con datos completos.
Por lo que se genera una nueva base de datos con 211.357 de los 211.494 clientes (se observaron 137 casos 0.06%)

## Análisis de componentes principales

Para identificar los principales componentes de la base de datos de clientes con créditos se realizó el análisis, con el gráfico de matriz de correlaciones visualizada mediante un "correlograma". Se muestra la relación entre las variables numéricas de la base de datos.

```{r}
mcor <- BDO_A %>% select(where(is.numeric)) %>% cor()
corrplot(mcor)
```


Las variables numéricas consideradas en la matriz de correlación son: SALDO, PRIMA, CREDITO, diascred, edad, y diascob. 
El color de las celdas varía desde el azul oscuro (correlación positiva alta) hasta el rojo oscuro (correlación negativa alta).
Azul oscuro indica una correlación positiva cercana a 1.
Rojo oscuro indica una correlación negativa cercana a -1.
Colores más claros indican correlaciones más cercanas a 0.
Tamaño: El tamaño de los círculos también indica la magnitud de la correlación.
Círculos más grandes indican una correlación más fuerte (positiva o negativa).
Círculos más pequeños indican una correlación más débil.
SALDO: Tiene una correlación positiva fuerte con PRIMA y CREDITO.
PRIMA: Además de la fuerte correlación con SALDO, también muestra una correlación positiva notable con CREDITO.
CREDITO: Correlaciona fuertemente con diascred.
diascred: Tiene una fuerte correlación positiva con CREDITO.
edad: Muestra correlaciones más débiles con las otras variables.
diascob: Correlaciona fuertemente con diascred.
Correlaciones Positivas Fuertes:
- SALDO y PRIMA
- SALDO y CREDITO
- PRIMA y CREDITO
- CREDITO y diascred
- diascred y diascob

Correlaciones Débiles o Inexistentes:
- Edad con otras variables muestra correlaciones débiles o casi inexistentes.
La matriz de correlaciones nos indica que hay fuertes relaciones entre algunas de las variables financieras como SALDO, PRIMA, y CREDITO, así como entre CREDITO, diascred y diascob.
Las correlaciones débiles de edad sugieren que la edad no tiene una relación fuerte con las demás variables en el conjunto de datos.
Se procedió al análisis de componentes principales PCA sobre la matriz de correlaciones. La interpretación de los resultados implica descomponer la matriz de correlaciones y reconstruirla usando un subconjunto de los componentes principales.

El gráfico muestra los valores propios (eigenvalues) de la matriz de correlaciones en orden descendente. Este tipo de gráfico colabora a determinar el número de componentes principales a retener, por lo que se podría considerar aquellos valores superiores o iguales a 1, considerando los primeros tres componentes.

Los valores propios (m1$values) y la proporción de varianza explicada por cada componente principal se presentan como sigue:

Primer componente principal: Explica el 42.37% de la varianza total.
Segundo componente principal: Explica el 19.10% de la varianza total.
Tercer componente principal: Explica el 16.47% de la varianza total.
Cuarto componente principal: Explica el 12.06% de la varianza total.
Quinto componente principal: Explica el 6.21% de la varianza total.
Sexto componente principal: Explica el 3.79% de la varianza total.
La varianza acumulada se calcula para determinar cuántos componentes principales son necesarios para explicar un cierto porcentaje de la varianza total:
Primer componente principal: Explica el 42.37% de la varianza acumulada.
Primeros dos componentes principales: Explican el 61.47% de la varianza acumulada.
Primeros tres componentes principales: Explican el 77.94% de la varianza acumulada.
Primeros cuatro componentes principales: Explican el 90.00% de la varianza acumulada.
Primeros cinco componentes principales: Explican el 96.21% de la varianza acumulada.
Todos los componentes principales: Explican el 100% de la varianza acumulada.
La decisión sobre cuántos componentes principales retener puede basarse en el porcentaje de varianza acumulada. Un criterio común es retener suficientes componentes para explicar al menos el 70-90% de la varianza total.
En este caso, los primeros tres componentes principales explican el 78.00% de la varianza acumulada, lo cual suele considerarse suficiente para la mayoría de los análisis.
En el gráfico muestra un claro "codo" (punto de inflexión) después del primer componente principal, con una disminución más gradual en los valores propios después del tercer componente principal. Esto sugiere que los primeros tres componentes capturan la mayor parte de la información relevante en los datos.




# Conclusiones

El desarrollo de un dashboard para la gestión de seguimiento de metas e indicadores en la comercialización de seguros ofrecerá a la entidad financiera una herramienta valiosa para optimizar su rendimiento comercial y adaptarse de manera ágil a un entorno dinámico. La implementación exitosa de este proyecto requerirá una comprensión profunda de las necesidades comerciales específicas y un enfoque integral en el diseño, implementación y mejora continua del dashboard.

La implementación del dashboard para el seguimiento de metas e indicadores en la comercialización de seguros proporciona a la entidad financiera una herramienta poderosa para la toma de decisiones informada. La visualización clara y en tiempo real de los datos clave facilita la identificación de tendencias, la evaluación del rendimiento y la respuesta ágil a cambios en el entorno comercial.

El dashboard contribuirá significativamente a mejorar la eficiencia operativa al proporcionar un acceso rápido y fácil a la información esencial.

La capacidad de personalizar la visualización de datos permite a los usuarios adaptar el dashboard a sus necesidades específicas.

La visualización clara de metas e indicadores ha facilitado la identificación temprana de oportunidades de crecimiento y desafíos potenciales.

# Recomendaciones

Se recomienda la implementación de programas de capacitación continua para los usuarios del dashboard. Esto garantizará que estén al tanto de las funciones más recientes, optimizando así su capacidad para aprovechar todas las capacidades de la herramienta.

A medida que evolucionan los objetivos comerciales y las estrategias, se recomienda la evaluación regular de la inclusión de nuevos indicadores relevantes en el dashboard. Esto garantizará que la herramienta siga siendo relevante y alineada con los objetivos comerciales cambiantes.

Dada la naturaleza sensible de los datos comerciales, se recomienda una revisión continua de las medidas de seguridad implementadas para garantizar la protección y privacidad de la información.

Establecer un sistema formal de retroalimentación de usuarios para recopilar comentarios y sugerencias. Esto permitirá realizar ajustes y mejoras en el dashboard en respuesta directa a las necesidades y experiencias de los usuarios.

# Referencias

https://www.asfi.gob.bo/images/ASFI/DOCS/SALA_DE_PRENSA/Notas_de_prensa/2022/SEPARATA_BOLIVIA_2022.pdf 
